<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <script src="auth.js"></script>
  <script src="main.js"></script>
</head>

<body>
  <sp-body>
    <!-- SECTION: AUTHENTICATION -->
    <section id="auth">
      <form id="api-key-form">
        <sp-heading size="S">Google AI Studio Setup</sp-heading>
        <sp-body size="S">
          To use this plugin, you need a free API key from Google AI Studio.
        </sp-body>
        <div class="mt-s mb-m">
          <sp-button variant="primary" id="open-astria">Get API Key</sp-button>
        </div>

        <sp-field-label for="api-key-input">API Key</sp-field-label>
        <div class="flex-row">
          <div class="rounded-input-wrapper" style="flex:1;">
            <sp-textfield id="api-key-input" name="apiKey" placeholder="AIza..."
              style="width:100%; border:none; background:transparent;"></sp-textfield>
          </div>
          <sp-button id="submit-auth" variant="cta">Save</sp-button>
          <sp-button id="cancel-auth" variant="secondary" style="display:none;">Cancel</sp-button>
        </div>
      </form>
    </section>

    <!-- SECTION: MAIN UI -->
    <section id="main" class="hidden">
      <form id="prompt-form">

        <!-- GROUP: INPUT -->
        <div class="section-group">
          <!-- Prompt Header -->
          <div class="flex-row-between mb-xs">
            <div class="flex-row" style="gap: 4px; width: 100%;">

              <!-- Refine Action (Left / Main) -->
              <div class="split-btn-container split-left variant-secondary" style="flex: 1; margin: 0;">
                <div id="btn-refine-prompt" class="split-btn-action" role="button" tabindex="0">
                  <span class="btn-text" style="font-size: 14px;">Refine prompt</span>
                </div>
              </div>

              <!-- Refine Model Selector (Right) -->
              <div class="split-btn-container split-right variant-secondary"
                style="flex: 0 0 auto; width: auto; margin: 0; margin-left: 6px;">
                <div class="split-btn-model" style="padding: 0 8px; width: 100%; justify-content: center;">
                  <div class="model-icon-wrapper" style="margin-right: 4px;">
                    <!-- Gemini Icon (scaled down slightly for secondary button if needed, or keep same) -->
                    <svg fill="currentColor" fill-rule="evenodd" height="1em" style="flex:none;line-height:1"
                      viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
                      <title>Gemini</title>
                      <path
                        d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z">
                      </path>
                    </svg>
                  </div>
                  <span id="refine-model-name-display"
                    style="font-size: 11px; margin-right: 4px; opacity: 0.9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; display: inline-block; vertical-align: middle;">Gemini
                    3 Pro</span>
                  <sp-picker id="refine-prompt-picker" class="integrated-picker" size="s" quiet>
                    <sp-menu id="refine-bg-menu" slot="options"></sp-menu>
                  </sp-picker>
                  <div
                    style="pointer-events: none; opacity: 0.8; margin-left: 2px; display: flex; align-items: center;">
                    <svg viewBox="0 0 10 10" width="12" height="12">
                      <path d="M2 3 L5 7 L8 3" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="rounded-input-wrapper mb-s">
            <sp-textarea id="prompt-input" name="prompt" placeholder="Describe the image..."
              style="width: 100%; height: 100px; font-family: adobe-clean; border:none; background:transparent;"></sp-textarea>
          </div>

          <!-- GROUP: ACTIONS -->
          <div class="section-group action-group mb-m">

            <div class="flex-row" style="align-items: center;">
              <!-- Split Button Container: Counter -->
              <div class="split-btn-container counter-btn"
                style="flex: 0 0 auto; width: auto; margin: 0; margin-right: 4px;">
                <!-- Variation Counter -->
                <div class="split-btn-counter" style="padding-right: 8px;">
                  <input type="number" id="variations-value" value="1" min="1" max="8">
                  <div class="split-spinner-controls">
                    <div class="split-spin-btn up" data-target="variations-value" data-step="1" data-max="8">
                      <svg viewBox="0 0 10 10" width="8" height="8">
                        <path d="M2 7 L5 3 L8 7" fill="none" stroke="currentColor" stroke-width="2"
                          stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                    </div>
                    <div class="split-spin-btn down" data-target="variations-value" data-step="1" data-min="1">
                      <svg viewBox="0 0 10 10" width="8" height="8">
                        <path d="M2 3 L5 7 L8 3" fill="none" stroke="currentColor" stroke-width="2"
                          stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Split Button Container: Generate -->
              <div class="split-btn-container generate-btn" style="flex: 1; margin: 0; margin-right: 4px;">
                <!-- Generate Action -->
                <div id="prompt-submit" class="split-btn-action" role="button" tabindex="0">
                  <span class="btn-text">Generate</span>
                  <sp-progress-circle id="spinner" size="s" indeterminate slot="icon"
                    style="display:none; margin-left:8px;"></sp-progress-circle>
                </div>
              </div>

              <!-- Model Selector (Right) -->
              <!-- Model Selector (Right) -->
              <!-- Model Selector (Right) -->
              <div class="split-btn-container model-selector-btn" style="flex: 0 0 auto; width: auto; margin: 0;">
                <div class="split-btn-model" style="padding: 0 8px; width: 100%; justify-content: center;">
                  <div class="model-icon-wrapper" style="margin-right: 4px;">
                    <svg fill="currentColor" fill-rule="evenodd" height="1em" style="flex:none;line-height:1"
                      viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
                      <title>Gemini</title>
                      <path
                        d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z">
                      </path>
                    </svg>
                  </div>
                  <sp-picker id="model-select-picker" class="integrated-picker" size="s" quiet>
                    <sp-menu id="model-select" slot="options"></sp-menu>
                  </sp-picker>
                  <div
                    style="pointer-events: none; opacity: 0.8; margin-left: 2px; display: flex; align-items: center;">
                    <svg viewBox="0 0 10 10" width="12" height="12">
                      <path d="M2 3 L5 7 L8 3" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Presets -->
          <div id="preset-section" class="mb-s">
            <div class="flex-row-between clickable py-xxs" id="preset-header-toggle">
              <div class="flex-row" style="gap: 10px;">
                <div id="preset-chevron">
                  <svg viewBox="0 0 10 10" width="10" height="10">
                    <path d="M3 2 L7 5 L3 8" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                </div>
                <sp-field-label class="m-0 clickable">Presets</sp-field-label>
                <span id="preset-count-badge" class="preset-count-badge">0</span>

              </div>
              <!-- Add Preset Button -->
              <sp-button id="btn-add-new-preset" variant="secondary" size="s">Create New</sp-button>
            </div>


            <!-- Collabsible Content Wrapper -->
            <div id="preset-content-wrapper">

              <!-- Presets List -->
              <div id="preset-list"></div>

              <!-- Add Preset Form (Spectrum Style) -->
              <div id="add-preset-section" class="mt-m hidden">
                <div class="flex-col p-0 gap-xs" id="add-preset-container">
                  <div class="rounded-input-wrapper w-full">
                    <sp-textfield id="new-preset-name" placeholder="Name" class="w-full"
                      style="border:none; background:transparent;"></sp-textfield>
                  </div>
                  <div class="rounded-input-wrapper" style="width: 100%;">
                    <sp-textarea id="new-preset-content" placeholder="Content..."
                      style="width: 100%; height: 60px; border:none; background:transparent;"></sp-textarea>
                  </div>
                  <div class="flex-row" style="justify-content: flex-end;">
                    <sp-button id="add-preset-btn" variant="cta" size="s">Save</sp-button>
                  </div>
                </div>
              </div>
            </div>
          </div>



          <!-- Context Settings (Expandable) -->
          <div id="context-section" class="mb-s">
            <div class="flex-row-between clickable py-xxs" id="context-header-toggle">
              <div class="flex-row" style="gap: 10px;">
                <div id="context-chevron">
                  <svg viewBox="0 0 10 10" width="10" height="10">
                    <path d="M3 2 L7 5 L3 8" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                </div>
                <sp-field-label class="m-0 clickable">Context Settings</sp-field-label>
              </div>
            </div>


            <div id="context-content-wrapper" class="hidden">
              <div class="section-group settings-group pt-xs">
                <div class="flex-col" style="width: 100%;">
                  <!-- Checkboxes (Moved to top) -->
                  <div class="flex-col gap-s items-start mb-l">
                    <div class="flex-row" style="gap: 10px;">
                      <sp-checkbox id="use-foreground" name="useForeground">Use Foreground Color</sp-checkbox>

                    </div>
                    <div class="flex-row" style="gap: 10px;">
                      <sp-checkbox id="use-layer-only" name="useLayerOnly">Selected Layer Only</sp-checkbox>

                    </div>
                  </div>
                  <!-- Reference Images (Moved here) -->
                  <div class="control-group mt-s mb-l">
                    <div class="flex-row-between mb-xs">
                      <div class="flex-row" style="gap: 10px;">
                        <sp-field-label for="reference-images" class="m-0">Reference Image</sp-field-label>

                      </div>
                      <sp-button id="reference-images" variant="secondary" size="s">Browse</sp-button>
                    </div>
                    <div id="selected-files" aria-label="Selected reference files" class="mt-xs"></div>
                  </div>

                  <!-- Upscale Context -->
                  <div class="settings-row">
                    <div class="flex-row items-center w-full justify-between">
                      <div class="flex-row" style="gap: 10px;">
                        <sp-field-label class="m-0">Upscale</sp-field-label>
                        <span class="beta-badge">BETA</span>

                      </div>
                      <!-- Upscale Compact Counter -->
                      <div class="upscale-counter-wrapper">
                        <input type="number" id="upscale-value" value="1" min="1" max="4" step="0.5">
                        <div class="upscale-spinner-controls">
                          <div class="upscale-spin-btn up" data-target="upscale-value" data-step="0.5" data-max="4">
                            <svg viewBox="0 0 10 10" width="8" height="8">
                              <path d="M2 7 L5 3 L8 7" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                          </div>
                          <div class="upscale-spin-btn down" data-target="upscale-value" data-step="0.5" data-min="1">
                            <svg viewBox="0 0 10 10" width="8" height="8">
                              <path d="M2 3 L5 7 L8 3" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>


              </div>
            </div>
          </div>
        </div>

        <!-- GROUP: ACTIONS -->
        <!-- GROUP: ACTIONS -->
        <!-- GROUP: ACTIONS -->

        <!-- GROUP: ACTIONS -->



        <!-- GROUP: CONTEXT SETTINGS -->


      </form>
    </section>

    <!-- FOOTER: API CONFIG -->
    <div id="api-management-section"
      style="margin-top: auto; padding-top: 16px; border-top: 1px solid var(--uxp-host-border-color);">
      <div class="flex-row-between">
        <div class="flex-col">
          <sp-detail>API Key Status</sp-detail>
          <sp-status-light size="s" variant="positive">Active</sp-status-light>
        </div>
        <sp-button id="signout" variant="secondary" size="s">Change</sp-button>
      </div>
    </div>

  </sp-body>
</body>

</html>