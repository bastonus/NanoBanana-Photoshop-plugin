<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <script src="auth.js"></script>
  <script src="main.js"></script>
</head>

<body>
  <sp-body>
    <!-- SECTION: AUTHENTICATION -->
    <section id="auth">
      <form id="api-key-form">
        <sp-heading size="S">Google AI Studio Setup</sp-heading>
        <sp-body size="S">
          To use this plugin, you need a free API key from Google AI Studio.
        </sp-body>
        <div class="mt-s mb-m">
          <sp-button variant="primary" id="open-astria">Get API Key</sp-button>
        </div>

        <sp-field-label for="api-key-input">API Key</sp-field-label>
        <div class="flex-row" style="gap: 16px;">
          <div class="rounded-input-wrapper" style="flex:1;">
            <sp-textfield id="api-key-input" name="apiKey" placeholder="AIza..."
              style="width:100%; border:none; background:transparent;"></sp-textfield>
          </div>
          <div style="width: 1px; height: 20px; background-color: rgba(255, 255, 255, 0.1);"></div>
          <sp-button id="submit-auth" variant="cta">Save</sp-button>

        </div>
      </form>
    </section>

    <!-- SECTION: MAIN UI -->
    <section id="main" class="hidden">
      <!-- TABS NAVIGATION -->
      <div class="tabs-nav mb-s">
        <div class="tab-item active" data-target="generator-view">
          <svg viewBox="0 0 18 18" width="12" height="12">
            <path
              d="M15.5,2h-13C1.7,2,1,2.7,1,3.5v11C1,15.3,1.7,16,2.5,16h13c0.8,0,1.5-0.7,1.5-1.5v-11C17,2.7,16.3,2,15.5,2z M15,14H3V4h12V14z M5,5h8v2H5V5z"
              fill="currentColor" />
          </svg>
          Generator
        </div>
        <div class="tab-item" data-target="chat-view">
          <svg viewBox="0 0 18 18" width="12" height="12">
            <path d="M14,2H4C2.9,2,2,2.9,2,4v12l4-4h8c1.1,0,2-0.9,2-2V4C16,2.9,15.1,2,14,2z M14,10H6l-2,2V4h10V10z"
              fill="currentColor" />
          </svg>
          Chat <span class="beta-badge">BETA</span>
        </div>
      </div>

      <!-- VIEW: GENERATOR -->
      <div id="generator-view" class="view-content active">
        <form id="prompt-form">

          <!-- GROUP: INPUT -->
          <div class="section-group">
            <!-- Prompt Header -->
            <div class="flex-row-between mb-xs">
              <div class="flex-row" style="gap: 4px; width: 100%;">

                <!-- Refine Action (Left / Main) -->
                <div class="split-btn-container split-left variant-secondary" style="flex: 1; margin: 0;">
                  <div id="btn-refine-prompt" class="split-btn-action" role="button" tabindex="0">
                    <span class="btn-text" style="font-size: 14px;">Refine prompt</span>
                  </div>
                </div>

                <!-- Refine Model Selector (Right) -->
                <div class="split-btn-container split-right variant-secondary"
                  style="flex: 0 0 auto; width: auto; margin: 0; margin-left: 6px;">
                  <div class="split-btn-model" style="padding: 0 8px; width: 100%; justify-content: center;">
                    <div class="model-icon-wrapper" style="margin-right: 4px;">
                      <!-- Gemini Icon -->
                      <svg fill="currentColor" fill-rule="evenodd" height="1em" style="flex:none;line-height:1"
                        viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
                        <title>Gemini</title>
                        <path
                          d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z">
                        </path>
                      </svg>
                    </div>
                    <span id="refine-model-name-display"
                      style="font-size: 11px; margin-right: 4px; opacity: 0.9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; display: inline-block; vertical-align: middle;">Gemini
                      3 Pro</span>
                    <sp-picker id="refine-prompt-picker" class="integrated-picker" size="s" quiet>
                      <sp-menu id="refine-bg-menu" slot="options"></sp-menu>
                    </sp-picker>
                    <div
                      style="pointer-events: none; opacity: 0.8; margin-left: 2px; display: flex; align-items: center;">
                      <svg viewBox="0 0 10 10" width="12" height="12">
                        <path d="M2 3 L5 7 L8 3" fill="none" stroke="currentColor" stroke-width="1.5"
                          stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <div class="rounded-input-wrapper mb-s">
              <sp-textarea id="prompt-input" name="prompt" placeholder="Describe the image..."
                style="width: 100%; height: 100px; font-family: adobe-clean; border:none; background:transparent;"></sp-textarea>
            </div>

            <!-- GROUP: ACTIONS -->
            <div class="section-group action-group mb-m">

              <div class="flex-row" style="align-items: center;">
                <!-- Split Button Container: Counter -->
                <div class="split-btn-container counter-btn"
                  style="flex: 0 0 auto; width: auto; margin: 0; margin-right: 4px;">
                  <!-- Variation Counter -->
                  <div class="split-btn-counter" style="padding-right: 8px;">
                    <input type="number" id="variations-value" value="1" min="1" max="8">
                    <div class="split-spinner-controls">
                      <div class="split-spin-btn up" data-target="variations-value" data-step="1" data-max="8">
                        <svg viewBox="0 0 10 10" width="8" height="8">
                          <path d="M2 7 L5 3 L8 7" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                      </div>
                      <div class="split-spin-btn down" data-target="variations-value" data-step="1" data-min="1">
                        <svg viewBox="0 0 10 10" width="8" height="8">
                          <path d="M2 3 L5 7 L8 3" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Split Button Container: Generate -->
                <div class="split-btn-container generate-btn" style="flex: 1; margin: 0; margin-right: 4px;">
                  <!-- Generate Action -->
                  <div id="prompt-submit" class="split-btn-action" role="button" tabindex="0">
                    <span class="btn-text">Generate</span>
                    <sp-progress-circle id="spinner" size="s" indeterminate slot="icon"
                      style="display:none; margin-left:8px;"></sp-progress-circle>
                  </div>
                </div>

                <!-- Model Selector (Right) -->
                <div class="split-btn-container model-selector-btn" style="flex: 0 0 auto; width: auto; margin: 0;">
                  <div class="split-btn-model" style="padding: 0 8px; width: 100%; justify-content: center;">
                    <div class="model-icon-wrapper" style="margin-right: 4px;">
                      <svg fill="currentColor" fill-rule="evenodd" height="1em" style="flex:none;line-height:1"
                        viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
                        <title>Gemini</title>
                        <path
                          d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z">
                        </path>
                      </svg>
                    </div>
                    <sp-picker id="model-select-picker" class="integrated-picker" size="s" quiet>
                      <sp-menu id="model-select" slot="options"></sp-menu>
                    </sp-picker>
                    <div
                      style="pointer-events: none; opacity: 0.8; margin-left: 2px; display: flex; align-items: center;">
                      <svg viewBox="0 0 10 10" width="12" height="12">
                        <path d="M2 3 L5 7 L8 3" fill="none" stroke="currentColor" stroke-width="1.5"
                          stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Presets -->
            <div id="preset-section" class="mb-s">
              <div class="flex-row-between clickable py-xxs" id="preset-header-toggle">
                <div class="flex-row" style="gap: 10px;">
                  <div id="preset-chevron">
                    <svg viewBox="0 0 10 10" width="10" height="10">
                      <path d="M3 2 L7 5 L3 8" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </div>
                  <sp-field-label class="m-0 clickable">Presets</sp-field-label>
                  <span id="preset-count-badge" class="preset-count-badge">0</span>

                </div>
                <!-- Add Preset Button -->
                <sp-button id="btn-add-new-preset" variant="secondary" size="s">Create New</sp-button>
              </div>


              <!-- Collabsible Content Wrapper -->
              <div id="preset-content-wrapper">

                <!-- Presets List -->
                <div id="preset-list"></div>

                <!-- Add Preset Form (Spectrum Style) -->
                <div id="add-preset-section" class="mt-m hidden">
                  <div class="flex-col p-0 gap-xs" id="add-preset-container">
                    <div class="rounded-input-wrapper w-full">
                      <sp-textfield id="new-preset-name" placeholder="Name" class="w-full"
                        style="border:none; background:transparent;"></sp-textfield>
                    </div>
                    <div class="rounded-input-wrapper" style="width: 100%;">
                      <sp-textarea id="new-preset-content" placeholder="Content..."
                        style="width: 100%; height: 60px; border:none; background:transparent;"></sp-textarea>
                    </div>
                    <div class="flex-row" style="justify-content: flex-end;">
                      <sp-button id="add-preset-btn" variant="cta" size="s">Save</sp-button>
                    </div>
                  </div>
                </div>
              </div>
            </div>



            <!-- Context Settings (Expandable) -->
            <div id="context-section" class="mb-s">
              <div class="flex-row-between clickable py-xxs" id="context-header-toggle">
                <div class="flex-row" style="gap: 10px;">
                  <div id="context-chevron">
                    <svg viewBox="0 0 10 10" width="10" height="10">
                      <path d="M3 2 L7 5 L3 8" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </div>
                  <sp-field-label class="m-0 clickable">Context Settings</sp-field-label>
                </div>
              </div>


              <div id="context-content-wrapper" class="hidden">
                <div class="section-group settings-group pt-xs">
                  <div class="flex-col" style="width: 100%;">
                    <!-- Checkboxes (Moved to top) -->
                    <div class="flex-col gap-s items-start mb-l">
                      <div class="flex-row" style="gap: 10px;">
                        <sp-checkbox id="use-foreground" name="useForeground">Use Foreground Color</sp-checkbox>
                      </div>
                      <div class="flex-row" style="gap: 10px;">
                        <sp-checkbox id="use-layer-only" name="useLayerOnly">Use only selected layer(s)</sp-checkbox>
                      </div>
                      <div class="flex-row" style="gap: 10px;">
                        <sp-checkbox id="use-exact-dimensions" name="useExactDimensions">Use exact
                          dimensions</sp-checkbox>
                      </div>
                    </div>
                    <!-- Reference Images (Moved here) -->
                    <div class="control-group mt-s mb-l">
                      <div class="flex-row-between mb-xs">
                        <div class="flex-row" style="gap: 10px;">
                          <sp-field-label for="reference-images" class="m-0">Reference Image</sp-field-label>
                        </div>
                        <div class="flex-row" style="gap: 6px;">
                          <sp-button id="reference-images" variant="secondary" size="s">Browse</sp-button>
                          <sp-button id="btn-add-selection" variant="secondary" size="s" title="Add active selection">
                            <svg slot="icon" viewBox="0 0 18 18" width="12" height="12">
                              <path
                                d="M15,3H3C2.4,3,2,3.4,2,4v10c0,0.6,0.4,1,1,1h12c0.6,0,1-0.4,1-1V4C16,3.4,15.6,3,15,3z M10,9H8v2H6V9H4V7h2V5h2v2h2V9z"
                                fill="currentColor" />
                            </svg>
                            Add Select.
                          </sp-button>
                        </div>
                      </div>
                      <div id="selected-files" aria-label="Selected reference files" class="mt-xs"></div>
                    </div>

                    <!-- Upscale Context -->
                    <div class="settings-row">
                      <div class="flex-row items-center w-full justify-between">
                        <div class="flex-row" style="gap: 10px;">
                          <sp-field-label class="m-0">Upscale</sp-field-label>
                          <span class="beta-badge">BETA</span>

                        </div>
                        <!-- Upscale Compact Counter -->
                        <div class="upscale-counter-wrapper">
                          <input type="number" id="upscale-value" value="1" min="1" max="4" step="0.5">
                          <div class="upscale-spinner-controls">
                            <div class="upscale-spin-btn up" data-target="upscale-value" data-step="0.5" data-max="4">
                              <svg viewBox="0 0 10 10" width="8" height="8">
                                <path d="M2 7 L5 3 L8 7" fill="none" stroke="currentColor" stroke-width="2"
                                  stroke-linecap="round" stroke-linejoin="round" />
                              </svg>
                            </div>
                            <div class="upscale-spin-btn down" data-target="upscale-value" data-step="0.5" data-min="1">
                              <svg viewBox="0 0 10 10" width="8" height="8">
                                <path d="M2 3 L5 7 L8 3" fill="none" stroke="currentColor" stroke-width="2"
                                  stroke-linecap="round" stroke-linejoin="round" />
                              </svg>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>



                  </div>
                </div>
              </div>
            </div>

            <!-- History (Expandable) -->
            <div id="history-section" class="mb-s">
              <div class="flex-row-between clickable py-xxs" id="history-header-toggle">
                <div class="flex-row" style="gap: 10px;">
                  <div id="history-chevron">
                    <svg viewBox="0 0 10 10" width="10" height="10">
                      <path d="M3 2 L7 5 L3 8" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </div>
                  <sp-field-label class="m-0 clickable">History</sp-field-label>
                </div>
              </div>

              <div id="history-content-wrapper" class="hidden">
                <div class="section-group settings-group pt-xs">
                  <div id="history-list" class="history-list-container">
                    <!-- History items will be injected here -->
                    <div class="history-empty-state">No history yet.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- VIEW: CHAT -->
      <div id="chat-view" class="view-content hidden">
        <div class="chat-layout">
          <!-- SIDEBAR -->
          <div class="chat-sidebar">
            <div class="chat-sidebar-header">
              <span>Chats</span>
              <div id="new-chat-btn" class="icon-btn" title="New Chat">
                <svg viewBox="0 0 10 10" width="10" height="10">
                  <path d="M5 2 L5 8 M2 5 L8 5" fill="none" stroke="currentColor" stroke-width="1.5" />
                </svg>
              </div>
            </div>
            <input type="text" id="chat-history-search" class="chat-search-box" placeholder="Search...">
            <div id="chat-history-list"></div>
          </div>

          <!-- MAIN CHAT -->
          <div class="chat-main">
            <div class="chat-header">
              <div class="chat-model-selector">
                <span id="chat-model-name-display">Gemini 1.5 Pro</span>
                <sp-picker id="chat-model-picker" class="integrated-picker" size="s" quiet>
                  <sp-menu id="chat-model-menu" slot="options"></sp-menu>
                </sp-picker>
                <div style="pointer-events: none; opacity: 0.8; margin-left: 2px;">
                  <svg viewBox="0 0 10 10" width="12" height="12">
                    <path d="M2 3 L5 7 L8 3" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                </div>
              </div>
            </div>
            <div id="chat-messages-container"></div>
            <div class="chat-input-wrapper">
              <!-- Image Preview Container -->
              <div id="chat-image-preview" class="hidden"></div>

              <div class="chat-input-row">
                <!-- Attach Button -->
                <button id="chat-attach-btn" title="Attach Image">
                  <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                    <path
                      d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 0 1 5 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 0 0 5 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z" />
                  </svg>
                </button>

                <sp-textarea id="chat-input" placeholder="Refine your prompt or ask for ideas..."
                  style="width: 100%; height: 40px; border:none; background:transparent; font-family: adobe-clean;"></sp-textarea>

                <div class="chat-input-actions">
                  <button id="chat-send-btn" title="Send">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                      <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </section>

    <!-- FOOTER: API CONFIG -->
    <div id="api-management-section">
      <div class="flex-row-between">
        <div class="flex-row" style="align-items: center;">
          <span style="font-size: 12px; font-weight: bold; margin-right: 4px;">API Key Status:</span>
          <div class="status-indicator-dot"></div>
          <span style="color: #2D9D78; font-size: 12px; font-weight: bold;">active</span>
        </div>
        <sp-button id="signout" variant="secondary" size="s">Change</sp-button>
      </div>
    </div>

  </sp-body>
</body>

</html>